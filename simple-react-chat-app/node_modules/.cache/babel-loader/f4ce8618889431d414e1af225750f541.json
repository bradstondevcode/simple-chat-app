{"ast":null,"code":"var _jsxFileName = \"/Users/bradston/Documents/Dev_Advocate/Blog Posts/Create Simple Realtime Chatroom with React, Node and Socket.io/simple-react-chat-app/src/pages/ChatRoom.js\";\nimport React, { Component } from 'react';\nimport Button from '@material-ui/core/Button';\nimport TextField from '@material-ui/core/TextField';\nimport IconButton from '@material-ui/core/IconButton';\nimport InputAdornment from '@material-ui/core/InputAdornment';\nimport SendIcon from '@material-ui/icons/Send';\nimport { Row, Container } from 'react-bootstrap';\nimport { socket } from '../services/socket';\nimport CurrentUserText from '../components/CurrentUserText';\nimport OtherUserText from '../components/OtherUserText';\nimport ChatNotification from '../components/ChatNotification';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet styles = {\n  chatRoomContainer: {\n    marginTop: 10\n  },\n  header: {\n    height: \"7vh\",\n    backgroundColor: 'rgba(0, 0, 0, 0.25)',\n    alignItems: 'center',\n    justifyContent: 'center',\n    display: 'flex',\n    borderTopLeftRadius: 8,\n    borderTopRightRadius: 8\n  },\n  headerText: {\n    fontSize: 20\n  },\n  chatThread: {\n    backgroundColor: 'rgba(227, 227, 227, 0.2)',\n    flex: 0,\n    display: 'flex',\n    flexDirection: 'column',\n    height: \"75vh\",\n    overflowY: 'auto',\n    width: '45vw',\n    alignSelf: 'center',\n    padding: 20,\n    paddingBottom: 40,\n    border: '1px solid rgba(0, 0, 0, 0.2)',\n    borderBottomLeftRadius: 8,\n    borderBottomRightRadius: 8,\n    marginBottom: 8\n  },\n  messageInputSection: {\n    display: 'flex',\n    justifyContent: 'flex-start'\n  },\n  messageTextField: {\n    flex: 1\n  },\n  messageSubmitButton: {\n    flex: 0\n  }\n};\nconst autoScrollOffset = 100; //offset value that allows screen to auto scroll when you are not exactly at bottom of chat window\n\nclass ChatRoom extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      currentUsername: \"User1\",\n      currentUserID: 1,\n      message: '',\n      chatRoomData: [],\n      initialLoad: true\n    }; //Create Ref for managing \"auto-scroll\"\n\n    this.messagesEndRef = /*#__PURE__*/React.createRef();\n  }\n\n  componentDidMount() {\n    // localStorage.removeItem('userID')\n    // localStorage.removeItem('username')\n    let userIDVal = localStorage.getItem('userID');\n    let usernameVal = localStorage.getItem('username'); //If user does not have a userid and username saved in local storage, create them for them\n\n    if (!userIDVal) {\n      socket.on(\"SetUserData\", userData => {\n        //When user creation on server is complete, retrieve and save data to local storage\n        localStorage.setItem('userID', userData.userID);\n        localStorage.setItem('username', userData.username);\n        console.log(userData);\n        this.setState({\n          currentUsername: userData.username,\n          currentUserID: userData.userID\n        }); //Notify Socket server is not ready to chat\n\n        socket.emit(\"UserEnteredRoom\", userData);\n      }); //Send Socket command to create user info for current user\n\n      socket.emit(\"CreateUserData\");\n    } else {\n      //If user already has userid and username, notify server to allow them to join chat\n      this.setState({\n        currentUsername: usernameVal,\n        currentUserID: userIDVal\n      });\n      socket.emit(\"UserEnteredRoom\", {\n        userID: userIDVal,\n        username: usernameVal\n      });\n    } //Retrieve game data (from Get Chat data socket call)\n\n\n    socket.on(\"RetrieveChatRoomData\", chatRoomData => {\n      this.setState({\n        chatRoomData: chatRoomData\n      }, () => this.shouldScrollToBottom());\n    });\n  }\n\n  componentWillUnmount() {\n    socket.off(\"RetrieveChatRoomData\");\n    socket.off(\"SetUserData\");\n  }\n\n  setMessage(message) {\n    //Set Message being typed in input field\n    this.setState({\n      message: message\n    });\n  }\n\n  sendMessageData() {\n    var {\n      message,\n      currentUsername,\n      currentUserID\n    } = this.state;\n\n    if (message.length > 0) {\n      //Send chat message to server...\n      socket.emit(\"SendMessage\", {\n        message: message,\n        username: currentUsername,\n        userID: currentUserID,\n        timeStamp: null\n      }); //Clear chat message textfield box\n\n      this.setState({\n        message: ''\n      });\n    }\n  }\n\n  shouldScrollToBottom() {\n    //If user is near the bottom of the chat, automatically navigate them to bottom when new chat message/notification appears\n    if (this.messagesEndRef.current.scrollHeight - this.messagesEndRef.current.scrollTop < this.messagesEndRef.current.offsetHeight + autoScrollOffset) {\n      this.scrollToBottom();\n    } //Navigate to end of chat when entering chat the first time\n\n\n    if (this.state.initialLoad) {\n      this.scrollToBottom();\n      this.setState({\n        initialLoad: false\n      });\n    }\n  }\n\n  scrollToBottom() {\n    //Scrolls user to end of chat message window\n    this.messagesEndRef.current.scrollTop = this.messagesEndRef.current.scrollHeight;\n  }\n\n  render() {\n    let {\n      chatRoomData,\n      currentUsername\n    } = this.state;\n    return /*#__PURE__*/_jsxDEV(Container, {\n      style: styles.chatRoomContainer,\n      children: [/*#__PURE__*/_jsxDEV(Container, {\n        style: styles.header,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: styles.headerText,\n          children: \"Chat Boom\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: styles.headerText,\n          children: [\"You appear as \", currentUsername]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 167,\n          columnNumber: 6\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(Container, {\n        style: styles.chatThread,\n        ref: this.messagesEndRef,\n        children: chatRoomData.map((messageData, index) => {\n          if (messageData.username == currentUsername) {\n            return /*#__PURE__*/_jsxDEV(CurrentUserText, {\n              username: messageData.username,\n              message: messageData.message\n            }, index, false, {\n              fileName: _jsxFileName,\n              lineNumber: 175,\n              columnNumber: 18\n            }, this);\n          } else if (messageData.username == '') {\n            return /*#__PURE__*/_jsxDEV(ChatNotification, {\n              username: messageData.username,\n              message: messageData.message\n            }, index, false, {\n              fileName: _jsxFileName,\n              lineNumber: 177,\n              columnNumber: 18\n            }, this);\n          } else {\n            return /*#__PURE__*/_jsxDEV(OtherUserText, {\n              username: messageData.username,\n              message: messageData.message\n            }, index, false, {\n              fileName: _jsxFileName,\n              lineNumber: 179,\n              columnNumber: 18\n            }, this);\n          }\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(Container, {\n        style: styles.messageInputSection,\n        children: /*#__PURE__*/_jsxDEV(TextField, {\n          style: styles.messageTextField,\n          id: \"input-with-icon-adornment\",\n          label: \"Enter Message\",\n          variant: \"outlined\",\n          value: this.state.message,\n          onChange: event => this.setMessage(event.target.value),\n          onKeyPress: event => {\n            if (event.key === 'Enter') {\n              console.log('Enter key pressed');\n              this.sendMessageData();\n            }\n          },\n          InputProps: {\n            endAdornment: /*#__PURE__*/_jsxDEV(InputAdornment, {\n              position: \"end\",\n              children: /*#__PURE__*/_jsxDEV(IconButton, {\n                onClick: () => this.sendMessageData(),\n                children: /*#__PURE__*/_jsxDEV(SendIcon, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 205,\n                  columnNumber: 15\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 204,\n                columnNumber: 14\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 203,\n              columnNumber: 13\n            }, this)\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 10\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 8\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 4\n    }, this);\n  }\n\n}\n\nexport default ChatRoom;","map":{"version":3,"sources":["/Users/bradston/Documents/Dev_Advocate/Blog Posts/Create Simple Realtime Chatroom with React, Node and Socket.io/simple-react-chat-app/src/pages/ChatRoom.js"],"names":["React","Component","Button","TextField","IconButton","InputAdornment","SendIcon","Row","Container","socket","CurrentUserText","OtherUserText","ChatNotification","styles","chatRoomContainer","marginTop","header","height","backgroundColor","alignItems","justifyContent","display","borderTopLeftRadius","borderTopRightRadius","headerText","fontSize","chatThread","flex","flexDirection","overflowY","width","alignSelf","padding","paddingBottom","border","borderBottomLeftRadius","borderBottomRightRadius","marginBottom","messageInputSection","messageTextField","messageSubmitButton","autoScrollOffset","ChatRoom","constructor","props","state","currentUsername","currentUserID","message","chatRoomData","initialLoad","messagesEndRef","createRef","componentDidMount","userIDVal","localStorage","getItem","usernameVal","on","userData","setItem","userID","username","console","log","setState","emit","shouldScrollToBottom","componentWillUnmount","off","setMessage","sendMessageData","length","timeStamp","current","scrollHeight","scrollTop","offsetHeight","scrollToBottom","render","map","messageData","index","event","target","value","key","endAdornment"],"mappings":"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","sourcesContent":["import React, {Component } from 'react';\nimport Button from '@material-ui/core/Button';\nimport TextField from '@material-ui/core/TextField';\nimport IconButton from '@material-ui/core/IconButton';\nimport InputAdornment from '@material-ui/core/InputAdornment';\nimport SendIcon from '@material-ui/icons/Send';\nimport { Row, Container } from 'react-bootstrap';\n\nimport {socket} from '../services/socket'\n\nimport CurrentUserText from '../components/CurrentUserText'\nimport OtherUserText from '../components/OtherUserText'\nimport ChatNotification from '../components/ChatNotification'\n\nlet styles = {\n\tchatRoomContainer: {\n\t\tmarginTop: 10,\n\t},\n\theader:{\n\t\theight: \"7vh\",\n\t\tbackgroundColor: 'rgba(0, 0, 0, 0.25)',\n\t\talignItems: 'center',\n\t\tjustifyContent: 'center',\n\t\tdisplay: 'flex',\n\t\tborderTopLeftRadius: 8,\n\t\tborderTopRightRadius: 8,\n\t},\n\theaderText: {\n\t\tfontSize: 20,\n\t},\n\tchatThread: {\n\t\tbackgroundColor: 'rgba(227, 227, 227, 0.2)',\n\t\tflex: 0,\n\t\tdisplay: 'flex',\n    \tflexDirection: 'column',\n    \theight: \"75vh\",\n    \toverflowY: 'auto',\n    \twidth: '45vw',\n    \talignSelf: 'center',\n    \tpadding: 20,\n    \tpaddingBottom: 40,\n    \tborder: '1px solid rgba(0, 0, 0, 0.2)',\n    \tborderBottomLeftRadius: 8,\n\t\tborderBottomRightRadius: 8,\n    \tmarginBottom: 8\n\t},\n\tmessageInputSection: {\n\t\tdisplay: 'flex',\n\t\tjustifyContent: 'flex-start',\n\t},\n\tmessageTextField: {\n\t\tflex: 1\n\t},\n\tmessageSubmitButton: {\n\t\tflex: 0\n\t}\n\n}\n\nconst autoScrollOffset = 100 //offset value that allows screen to auto scroll when you are not exactly at bottom of chat window\n\nclass ChatRoom extends Component {\n\n\tconstructor(props) {\n\t    super(props);\n\t    this.state = {\n\t    \tcurrentUsername: \"User1\",\n\t    \tcurrentUserID: 1,\n\t    \tmessage: '',\n\t    \tchatRoomData: [\n\t    \t],\n\t    \tinitialLoad: true,\n\t    };\n\t    //Create Ref for managing \"auto-scroll\"\n\t    this.messagesEndRef = React.createRef()\n\t}\n\n\tcomponentDidMount(){\n\n\t\t// localStorage.removeItem('userID')\n\t\t// localStorage.removeItem('username')\n\n\t\tlet userIDVal = localStorage.getItem('userID')\n\t\tlet usernameVal = localStorage.getItem('username')\n\n\t\t//If user does not have a userid and username saved in local storage, create them for them\n\t\tif(!userIDVal){\n\n\t      socket.on(\"SetUserData\", userData => {\n\t        //When user creation on server is complete, retrieve and save data to local storage\n\t        localStorage.setItem('userID', userData.userID)\n\t        localStorage.setItem('username', userData.username)\n\t        console.log(userData)\n\n\t        this.setState({currentUsername: userData.username, currentUserID: userData.userID})\n\n\t        //Notify Socket server is not ready to chat\n\t        socket.emit(\"UserEnteredRoom\", userData)\n\t      });\n\n\t      //Send Socket command to create user info for current user\n\t      socket.emit(\"CreateUserData\")\n\t    } \n\t    else {\n\t    \t//If user already has userid and username, notify server to allow them to join chat\n\t    \tthis.setState({currentUsername: usernameVal, currentUserID: userIDVal})\n\t    \tsocket.emit(\"UserEnteredRoom\", {userID: userIDVal, username: usernameVal})\n\t    }\n\n\t    //Retrieve game data (from Get Chat data socket call)\n\t    socket.on(\"RetrieveChatRoomData\", (chatRoomData) => {\n\t    \tthis.setState({chatRoomData: chatRoomData}, () => this.shouldScrollToBottom())\n\t    })\n\n\t}\n\n\tcomponentWillUnmount(){\n\t\tsocket.off(\"RetrieveChatRoomData\")\n\t\tsocket.off(\"SetUserData\")\n\t}\n\n\tsetMessage(message){\n\t\t//Set Message being typed in input field\n\t\tthis.setState({message: message})\n\t}\n\n\tsendMessageData(){\n\t\tvar {message, currentUsername, currentUserID} = this.state\n\n\t\tif(message.length > 0){\n\t\t\t//Send chat message to server...\n\t\t\tsocket.emit(\"SendMessage\", {message: message, username: currentUsername, userID: currentUserID, timeStamp: null})\n\t\t\t//Clear chat message textfield box\n\t\t\tthis.setState({message: ''})\n\t\t}\n\t}\n\n\n\tshouldScrollToBottom(){\n\t\t//If user is near the bottom of the chat, automatically navigate them to bottom when new chat message/notification appears\n\t\tif (this.messagesEndRef.current.scrollHeight - this.messagesEndRef.current.scrollTop < this.messagesEndRef.current.offsetHeight + autoScrollOffset){\n\t\t\tthis.scrollToBottom()\n\t\t}\n\n\t\t//Navigate to end of chat when entering chat the first time\n\t\tif(this.state.initialLoad){\n\t\t\tthis.scrollToBottom()\n\t\t\tthis.setState({initialLoad: false})\n\t\t}\n\t}\n\n\tscrollToBottom(){\n\t\t//Scrolls user to end of chat message window\n\t\tthis.messagesEndRef.current.scrollTop = this.messagesEndRef.current.scrollHeight\n\t}\n\n\n\trender(){\n\n\t\tlet {chatRoomData, currentUsername} = this.state\n\n\t\treturn (\n\t\t\t<Container style = {styles.chatRoomContainer}>\n\n\t\t\t\t<Container style ={styles.header}>\n\t\t\t\t\t<div style={styles.headerText}>Chat Boom</div>\n\t\t\t\t\t<div style={styles.headerText}>You appear as {currentUsername}</div>\n\t\t\t\t</Container>\n\t\t\t\t\n\n\t\t\t\t<Container style={styles.chatThread} ref={this.messagesEndRef}>\n\t\t\t\t\t{chatRoomData.map( (messageData, index) => {\n\n\t\t\t\t\t\tif(messageData.username == currentUsername) {\n\t\t\t    \t\t\treturn <CurrentUserText key={index} username={messageData.username} message={messageData.message}/>\n\t\t\t    \t\t} else if (messageData.username == '') {\n\t\t\t    \t\t\treturn <ChatNotification key={index} username={messageData.username} message={messageData.message}/>\n\t\t\t    \t\t} else {\n\t\t\t    \t\t\treturn <OtherUserText key={index} username={messageData.username} message={messageData.message}/>\n\t\t\t    \t\t}\n\t\t    \t\t\t\n\t\t    \t\t})}\n\n\t  \t\t\t\t\n\t    \t\t</Container>\n\n\t    \t\t<Container style={styles.messageInputSection}>\n\t\t\t    \t\t<TextField \n\t\t\t    \t\t\tstyle= {styles.messageTextField}\n\t\t\t    \t\t\tid=\"input-with-icon-adornment\" \n\t\t\t    \t\t\tlabel=\"Enter Message\" \n\t\t\t    \t\t\tvariant=\"outlined\"  \n\t\t\t    \t\t\tvalue={this.state.message} \n\t\t\t    \t\t\tonChange={(event) => this.setMessage(event.target.value)}\n\t\t\t    \t\t\tonKeyPress= {(event) => {\n\t\t\t\t\t            if (event.key === 'Enter') {\n\t\t\t\t\t              console.log('Enter key pressed');\n\t\t\t\t\t              this.sendMessageData()\n\t\t\t\t\t            }\n\t\t\t\t\t\t    }}\n\t\t\t\t\t\t    InputProps={{\n\t\t\t\t\t\t    \tendAdornment:(\n\t\t\t\t\t\t\t    \t<InputAdornment position=\"end\">\n\t\t\t\t\t\t\t    \t\t<IconButton onClick={() => this.sendMessageData()}>\n\t\t\t\t\t\t\t    \t\t\t<SendIcon/>\n\t\t\t\t\t\t\t    \t\t</IconButton>\n\t\t\t\t\t\t\t    \t</InputAdornment>\n\t\t\t\t\t\t\t    )\n\t\t\t\t\t\t    }}\n\t\t\t    \t\t/>\n\t\t\t\t</Container>\n\n\t\t\t</Container>\n\t\t);\n\t}\n}\n\nexport default ChatRoom;"]},"metadata":{},"sourceType":"module"}